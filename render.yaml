# Render Blueprint – FX Trading App
# Docs: https://render.com/docs/infrastructure-as-code

databases:
  - name: fx-trading-postgres
    plan: free
    region: oregon

services:
  # ---------------------------------------------------------------------------
  # Key Value (Redis) – used by BullMQ (email queue) and cache-manager (FX rates)
  # ---------------------------------------------------------------------------
  - type: keyvalue
    name: fx-trading-redis
    plan: free
    region: oregon
    ipAllowList: []                 # internal connections only

  # ---------------------------------------------------------------------------
  # Web Service – the NestJS application
  # ---------------------------------------------------------------------------
  - type: web
    name: fx-trading-app
    plan: free
    region: oregon
    runtime: docker
    healthCheckPath: /api/v1/health

    envVars:
      # ── Database & Redis (cross-service references) ──────────────────────
      - key: DATABASE_URL
        fromDatabase:
          name: fx-trading-postgres
          property: connectionString

      - key: REDIS_URL
        fromService:
          name: fx-trading-redis
          type: keyvalue
          property: connectionString

      # ── Runtime ───────────────────────────────────────────────────────────
      - key: NODE_ENV
        value: production

      - key: API_PREFIX
        value: api/v1

      # ── JWT ───────────────────────────────────────────────────────────────
      - key: JWT_SECRET
        value: your-super-secret-jwt-key-change-in-production
      - key: JWT_EXPIRATION
        value: 1h
      - key: JWT_REFRESH_SECRET
        value: your-super-secret-refresh-key-change-in-production
      - key: JWT_REFRESH_EXPIRATION
        value: 7d

      # ── SMTP / Email ──────────────────────────────────────────────────────
      # Use a Gmail App Password (not your account password) when 2FA is on.
      - key: SMTP_HOST
        value: smtp.gmail.com
      - key: SMTP_PORT
        value: "587"
      - key: SMTP_SECURE
        value: "false"
      - key: SMTP_USER
        value: williamobi818@gmail.com
      - key: SMTP_PASSWORD
        value: ggvgwrpnknudzupr
      - key: EMAIL_FROM
        value: "FX Trading <noreply@fxtrading.com>"

      # ── OTP ───────────────────────────────────────────────────────────────
      - key: OTP_EXPIRATION_MINUTES
        value: "10"

      # ── FX Rate API ───────────────────────────────────────────────────────
      - key: FX_RATE_API_URL
        value: https://api.exchangerate-api.com/v4/latest
      - key: FX_RATE_CACHE_TTL
        value: "300"

      # ── Wallet ────────────────────────────────────────────────────────────
      - key: INITIAL_WALLET_BALANCE
        value: "100"
      - key: BASE_CURRENCY
        value: NGN
